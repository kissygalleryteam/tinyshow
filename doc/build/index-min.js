/*!build time : 2014-06-08 1:10:35 AM*/
var __hasProp={}.hasOwnProperty;KISSY.add("kg/tinyshow/2.0.0/main",function(a,b,c){var d,e;return d=b.all,e=function(){function b(a){this.config=a,this.config.el=d(this.config.el),this.config.el&&(this.config.src=this.config.src||this.config.el.attr("data-ks-ts-image")||this.config.el.attr("data-origin-url")||this.config.el.attr("data-original-url")||this.config.el.attr("src"),this.config.src&&(this.config.loadDelay=parseInt(this.config.loadDelay)||0,this.bg=d('<div class="ks-tiny-show-bg" title="\u70b9\u51fb\u5173\u95ed"></div>'),this.loading=d('<div class="ks-tiny-show-loading"></div>'),this.pic=d('<img class="ks-tiny-show-img" title="\u6eda\u8f6e\u8c03\u6574\u5927\u5c0f" />'),this.rawImg=new Image,this.percent=2.0.0,this.isShow=!1,this.viewportWidth=d(document).width(),this.viewportHeight=d(document).height(),this.init()))}return b.prototype.init=function(){return this.pic.appendTo(this.bg),this.loading.appendTo(this.bg),this.bg.appendTo("body"),this._bindEvents(),a.later(function(a){return function(){return a.rawImg?(a.rawImg.src=a.config.src,a._checkLoading()):void 0}}(this),this.config.loadDelay)},b.prototype.show=function(){return this.isShow=!0,this.bg.css("left",0),this.pic.css({opacity:0,display:"inline-block"}),c(this.pic,{opacity:1},.4,"easeOut").run(),this._bindWheelEvent(),this._bindClose(),this._bindDrag()},b.prototype.close=function(){return this.isShow=!1,this.pic.hide(),this.bg.css("left","-200%"),this.bg.detach("click mouseleave mousewheel pinch pinchStart pinchEnd"),this.pic.detach("click touchstart touchmove touchend mousedown mousemove mouseup mouseleave")},b.prototype.destroy=function(){var a,b,c;this.bg.remove().empty(),c=[];for(a in this)__hasProp.call(this,a)&&(b=this[a],c.push(this[a]=null));return c},b.prototype._checkLoading=function(){return this.rawImg?this.rawImg.width&&this.rawImg.complete?this._loadHandler():a.later(this._checkLoading,2.0.0,!1,this):void 0},b.prototype._setLoading=function(){},b.prototype._removeLoading=function(){return this.loading.remove()},b.prototype._bindEvents=function(){return this._bindClick()},b.prototype._bindClose=function(){return this.pic.on("click",function(a){return a.halt()}),this.bg.on("click",function(a){return function(){return a.close()}}(this))},b.prototype._bindClick=function(){return this.config.el.on("click",function(a){return function(){return a.show()}}(this))},b.prototype._loadHandler=function(){var a;return this._removeLoading(),this.pic.attr("src",this.rawImg.src),this.width=this.rawImg.width,this.height=this.rawImg.height,this.pic.offset({left:(this.viewportWidth-this.width)/2,top:(a=(this.viewportHeight-this.height)/2)<0?0:a}),this.isShow?this.pic.show():this.pic.hide()},b.prototype._bindWheelEvent=function(){var a,b;return b=this.percent,a=this.percent,this.bg.on("mousewheel pinch",function(c){return function(d){var e,f;return d.halt(),d.scale?(a=c.percent,c.percent=b*d.scale,f=c.percent-a):(f=d.delta>0?2:-2,c.percent+=f),c.percent>400&&(c.percent=400),c.percent<10&&(c.percent=10),e=c.pic.offset().left,c.pic.css({width:c.percent/2.0.0*c.width,height:c.percent/2.0.0*c.height,left:e-f/2.0.0*c.width/2})}}(this)),this.bg.on("pinchStart",function(a){return function(c){return c.halt(),a.allowMove=!1,b=a.percent}}(this)),this.bg.on("pinchEnd",function(a){return function(b){return b.halt(),a.allowMove=!0}}(this))},b.prototype._bindDrag=function(){var a,b,c,d,e,f,g;return f=[null,null],b=f[0],c=f[1],g=[null,null],d=g[0],e=g[1],a=!1,this.pic.on("touchstart mousedown",function(f){return function(g){var h,i,j;return a=!0,g.preventDefault(),g=g.originalEvent,h=[f.pic.offset().left,f.pic.offset().top],b=h[0],c=h[1],g.touches?(i=[g.touches[0].pageX,g.touches[0].pageY],d=i[0],e=i[1],i):(j=[g.pageX||g.clientX,g.pageY||g.clientY],d=j[0],e=j[1],j)}}(this)),this.pic.on("touchmove mousemove",function(f){return function(g){var h,i,j,k,l,m,n;if(a!==!1&&f.allowMove!==!1)return g.preventDefault(),g=g.originalEvent,g.touches?(l=[g.touches[0].pageX,g.touches[0].pageY],h=l[0],i=l[1]):(m=[g.pageX||g.clientX,g.pageY||g.clientY],h=m[0],i=m[1]),n=[h-d,i-e],j=n[0],k=n[1],f.pic.offset({left:b+j,top:c+k})}}(this)),this.pic.on("mouseleave mouseup touchend",function(b){return function(){return a=!1,b.allowMove=!0}}(this)),this.bg.on("mouseleave",function(){return a=!1})},b}()},{requires:["node","anim"]}),KISSY.add("kg/tinyshow/2.0.0/index",function(a,b){return b},{requires:["./main"]});